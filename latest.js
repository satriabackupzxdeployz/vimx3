(()=>{var{defineProperty:V,getOwnPropertyNames:w,getOwnPropertyDescriptor:G}=Object,R=Object.prototype.hasOwnProperty;var z=new WeakMap,E=(j)=>{var B=z.get(j),J;if(B)return B;if(B=V({},"__esModule",{value:!0}),j&&typeof j==="object"||typeof j==="function")w(j).map((H)=>!R.call(B,H)&&V(B,H,{get:()=>j[H],enumerable:!(J=G(j,H))||J.enumerable}));return z.set(j,B),B};var K=(j,B)=>{for(var J in B)V(j,J,{get:B[J],enumerable:!0,configurable:!0,set:(H)=>B[J]=()=>H})};var N={};K(N,{default:()=>I,GeddleSDK:()=>$});function A(){let j=window.location.hostname;if(j==="localhost"||j.match(/^\d+\.\d+\.\d+\.\d+$/))return j;let B=j.split(".");if(B.length>2)return B.slice(-2).join(".");return j}function O(j,B,J){let H=`geddle_${j}`,M=new Date;M.setTime(M.getTime()+J*24*60*60*1000);let T=`expires=${M.toUTCString()}`,U=A(),b=`${H}=${encodeURIComponent(B)};${T};path=/;domain=.${U};SameSite=Lax`;if(U==="localhost"||U.match(/^\d+\.\d+\.\d+\.\d+$/))document.cookie=`${H}=${encodeURIComponent(B)};${T};path=/;SameSite=Lax`;else document.cookie=b}function W(j){let J=`${`geddle_${j}`}=`,H=document.cookie.split(";");for(let M of H)if(M=M.trim(),M.indexOf(J)===0)return decodeURIComponent(M.substring(J.length));return null}function X(j){let B=`geddle_${j}`,J=A();document.cookie=`${B}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;domain=.${J};SameSite=Lax`,document.cookie=`${B}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;SameSite=Lax`}function Y(j,B){try{localStorage.setItem(`geddle_${j}`,B)}catch(J){}}function Z(j){try{return localStorage.getItem(`geddle_${j}`)}catch(B){return null}}function _(j){try{localStorage.removeItem(`geddle_${j}`)}catch(B){}}async function q(j){let J={referral_code:j.referral_code,product_id:j.product_id||"",url:j.url,referrer:j.referrer};try{let H=await fetch("https://api.geddle.com/tracking/click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J)});if(H.ok){let M=await H.json();if(M.track_id)return M.track_id;else return null}else return null}catch(H){return null}}async function F(j){let B={event_type:j.type,track_id:j.track_id,metadata:{...j.metadata,email:j.email}},J="https://api.geddle.com/tracking/event";try{if(!(await fetch("https://api.geddle.com/tracking/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).ok);}catch(H){}}var P=document.currentScript||document.querySelector('script[src*="/geddle."]')||(()=>{let j=document.getElementsByTagName("script");return j[j.length-1]})();class ${trackId=null;referralCode=null;config={};cookieDuration=60;attributionModel="last-click";constructor(j){if(this.config=this.getScriptConfig(),j)this.config={...this.config,...j};this.cookieDuration=this.config.cookieDuration||60,this.attributionModel=this.config.attributionModel||"last-click",this.init()}getScriptConfig(){if(!P)return{};return{productId:P.getAttribute("data-product-id")||null,cookieDuration:parseInt(P.getAttribute("data-cookie-duration")||"60",10),attributionModel:P.getAttribute("data-attribution-model")||"last-click"}}async init(){if(this.trackId=W("referral"),this.referralCode=W("code"),!this.trackId){if(this.trackId=Z("referral"),this.trackId)O("referral",this.trackId,this.cookieDuration)}if(!this.referralCode){if(this.referralCode=Z("code"),this.referralCode)O("code",this.referralCode,this.cookieDuration)}let j=new URLSearchParams(window.location.search),B=j.get("aff")||j.get("via")||j.get("ref")||j.get("r");if(B){if(this.shouldTrackReferral(B)){let H=await q({referral_code:B,url:window.location.href,referrer:document.referrer||void 0,product_id:this.config.productId});if(H)this.trackId=H,this.referralCode=B,O("referral",H,this.cookieDuration),O("code",B,this.cookieDuration),Y("referral",H),Y("code",B)}}}shouldTrackReferral(j){if(!this.referralCode||!this.trackId)return!0;if(this.referralCode===j)return!1;if(this.attributionModel==="last-click")return!0;else return!1}async trackSignup(j){await this.trackEvent("signup",{email:j})}async trackEvent(j,B){if(!this.trackId)return;let{email:J,...H}=B||{};await F({track_id:this.trackId,type:j,email:J,metadata:Object.keys(H).length>0?H:void 0})}getReferral(){return this.trackId}clearReferral(){this.trackId=null,this.referralCode=null,X("referral"),X("code"),_("referral"),_("code")}getReferralCode(){return this.referralCode}setAttributionModel(j){this.attributionModel=j}}var Q=new $;window.Geddle=Q;var I=Q;})();
